<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文件上传和下载</title>
</head>
<body>
    <h1>文件上传和下载</h1>

    <!-- 上传表单 -->
    <h2>上传文件</h2>
    <form id="uploadForm" enctype="multipart/form-data">
        <label for="username">用户名:</label>
        <input type="text" id="username" name="username" required maxlength="32" /><br/><br/>

        <label for="file">选择文件:</label>
        <input type="file" id="file" name="file" required /><br/><br/>

        <button type="submit">上传文件</button>
    </form>

    <hr/>

    <!-- 下载表单 -->
    <h2>下载文件</h2>
    <form id="downloadForm">
        <label for="downloadUsername">用户名:</label>
        <input type="text" id="downloadUsername" required maxlength="32" /><br/><br/>

        <label for="fileCategory">文件分类:</label>
        <select id="fileCategory" name="fileCategory">
            <option value="视频">视频</option>
            <option value="图片">图片</option>
            <option value="文档">文档</option>
            <option value="扩展">扩展</option>
            <option value="音频">音频</option>
        </select><br/><br/>

        <label for="filename">文件名:</label>
        <input type="text" id="filename" required /><br/><br/>

        <button type="submit">下载文件</button>
    </form>

    <script>
        // 上传文件处理
        document.getElementById('uploadForm').addEventListener('submit', function(e) {
            e.preventDefault();

            let formData = new FormData();
            formData.append("username", document.getElementById('username').value);
            formData.append("file", document.getElementById('file').files[0]);

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => alert('上传成功！'))
            .catch(error => alert('上传失败：' + error.message));
        });

        // 下载文件处理
        document.getElementById('downloadForm').addEventListener('submit', function(e) {
            e.preventDefault();

            let username = document.getElementById('downloadUsername').value;
            let category = document.getElementById('fileCategory').value;
            let filename = document.getElementById('filename').value;

            // 构造下载链接
            let downloadUrl = `/download/${username}/${category}/${filename}`;

            window.location.href = downloadUrl;
        });
    </script>
</body>
</html>
